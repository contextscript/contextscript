<!DOCTYPE html>
<html>

<head>
	<meta charset=utf-8 />
	<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
	<title>Context Script</title>
	<meta name="Description" content="Scripts for any situation.">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="/site.css" type="text/css" rel="stylesheet" />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://login.persona.org/include.js" type="text/javascript"></script>
<script>
$(function(){
    $.when(
        $.get("/injectContextScript.js"),
        $.get("/ctxscript-core.css")
    ).then(function(injectScript, coreCSS){
        injectScript = injectScript[0];
        coreCSS = coreCSS[0];
        var config = <%- JSON.stringify(config) %>;
        var loadCssFunc = "function(){";
        loadCssFunc += "var ss = document.createElement('link');";
        loadCssFunc += "ss.rel = 'stylesheet';";
        loadCssFunc += "ss.href = 'data:text/css," + escape(coreCSS) + "';";
        loadCssFunc += "document.body.appendChild(ss);";
        loadCssFunc += "}";
        script = (
            injectScript +
            "injectContextScript(" +
	            JSON.stringify(config) + "," +
	            "{ init : " + loadCssFunc + "}" +
            ");"
        );
        $(".bookmarklet-area").append($('<a class="bookmarklet">').prop({
            href: "javascript:" + encodeURI(script)
        }).text(config.user ? "Context Script" : "Context Script Demo"));
    });
});
</script>
</head>

<body>
	<div class="header">
		<h2><a href="/">Context Script</a></h2>
	</div>
	<div class="menu-bar">
		<div class="menu-bar-container">
		<% if (!user) { %>
			<script>
				$(function() {
					$("#browserid").click(function() {
						navigator.id.get(function(assertion) {
							if (assertion) {
								$("input").val(assertion);
								$("form").submit();
							}
							else {
								location.reload();
							}
						});
					});
				});
			</script>
			<form action="/auth/browserid?redirect=/myscripts" method="post" style="display:none;">
				<input type="text" name="assertion" />
			</form>
			<a class="btn" id="browserid">Sign In</a>
		<% } else { %>
			<a class="btn" href="/myscripts">My Account</a><!--
			--><a class="btn" href="/logout">Sign Out</a>
		<% } %>
		</div>
	</div>
	<div class="main">
		<%- body %>
	</div>
	<hr>
	<div class="footer-links">
		<a href="https://github.com/contextscript/contextscript">Context Script github</a>
		<a href="https://groups.google.com/forum/#!forum/context-script">Mailing list</a>
	</div>
</body>

</html>
